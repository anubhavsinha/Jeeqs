<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    {% include "head.html" %}
</head>

<script>
    /**
     * Renders a user friendly text for his opinion
     * @param feedback
     */
    renderFeedback = function(feedback) {
        switch (feedback) {
            case 1:
                return "Incorrect";
                break;
            case 2:
                return "Almost there!";
            case 3:
                return "Correct";
            case 4:
                return "Elegant";
        }
    }

    window.onload = function () {
        prettyPrint();
    }

    $(document).ready(function() {
        $('.submit-vote').bind('click', function(e) {
            $initiator = $(this)
            $submission_id = $(this).parent().parent().children("input[type='hidden']:first").val();
            $vote = $(this).siblings('.slider').slider( "option", "value" );

            $.ajax({
                url: "/rpc",
                type: "POST",
                data: {'method': 'submit_vote', 'submission_key':$submission_id, 'vote':$vote},
                success: function(response){
                    $initiator.attr("disabled", "disabled");
                    $initiator.siblings(".slider").slider("option", "disabled", true);
                }
            })
        })

        $( ".slider" ).each(function() {
            $disabled = $(this).siblings('.submit-vote').attr('disabled');
            $defaultValue = 3
            $(this).slider({
                value:$defaultValue,
                min: 1,
                max: 4,
                step: 1,
                disabled: ($disabled == 'disabled' ? true : false),
                slide: function( event, ui ) {
                    $(this).siblings('.slider-text').text(renderFeedback(ui.value));
                }
            }).find('.ui-slider-handle')
              .attr("title", "Slide me to score the submission");
        })
    })
</script>

<style>
    .submission-feedback { padding: 10px !important; width:50%;}
    .slider-text {padding: 10px; padding-right:0px; color:#006666; font-size:smaller; float:right;}
</style>



<body>
    {% include "challenge.html" %}

    <br/>

    <div id="submissions" style="width:45%; float:left">
        {% if submissions|length == 0 %}
            <p> No Submissions are available to review </p>
        {% else %}
            {% for submission in submissions %}
                <div class="submission-placeholder">
                    <input type="hidden" value="{{ submission.key }}"/>
                    <h3>Submitted by {{ submission.author }} </h3>
                    <pre class="prettyprint">{{ submission.content }}</pre>
                    <div class="submission-feedback">
                        <div class="slider"></div>
                        <div id="slider-text" class="slider-text"></div>
                        <button class="submit-vote" {{ submission.voted|yesno:'disabled=disabled,' }} style="margin-top:10px;">Submit</button>
                    </div>
                </div>
            {% endfor %}
        {% endif %}
    </div>

    {% include "user.html" %}

</body>
</html>