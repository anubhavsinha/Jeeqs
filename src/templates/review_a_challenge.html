{% from 'avatars.html' import avatar %}
<script>
    {# Need to run tooltip since this page is dynamically loaded into browser.  #}
    $(document).ready(function() {
        $('a[rel=tooltip]').tooltip()
    })
</script>
<div id="submissions">
    {% if submissions|length == 0 %}
    {%if not review_qualified and not challenge.public_submissions%}
    <div class="gray">The submissions to this challenge are only visible to users who have solved the challenge.</div>
    {% else %}
    <div class="gray"> No Submissions</div>
    {% endif %}
    {% else %}
    {% for submission in submissions %}
    <div class="submission-placeholder" class="pull-left clear-left">
        <div>
            {{ avatar(style='pull-left avatar_review', jeeqser_key=submission.author, avatar_url=submission.author.get().profile_url) }}
            <div class="pull-left gray">
                Submitted by {{ submission.author.get().displayname }}
                <span class="gray">{{ submission.date|timesince }} </span>
            </div>
            <div class="pull-right gray">
                {{ submission.vote_count }} votes submitted
            </div>
        </div>
        <div style="padding: 10px; overflow: auto; clear:left;">
            {{ submission.content|safe }}
        </div>
        {% if review_qualified %}
        <div class="submission-feedback">
            <div class="feedback-buttons btn-group" data-toggle="buttons-radio">
                <button value="correct" class="btn"><i class="icon-ok"></i></button>
                <button value="incorrect" class="btn"><i class="icon-remove"></i></button>
                <button value="flag" class="btn"><i class="icon-flag"></i></button>
            </div>
            <textarea id="response__{{ submission.key.urlsafe() }}" class="span12"></textarea>
            <a href="#" rel="tooltip" title="Markdown and MathJax are supported."><i class="icon-info-sign"></i></a>
            {% set submitted = 'Submitted' %}
            {% if not submission.voted %}
            {% set submitted = 'Submit' %}
            {% endif %}
            <button class="submit-vote btn btn-primary pull-right" data-submitted-text="Submitted!" id="submit__{{ submission.key.urlsafe() }}" >{{ submitted }}</button>
        </div>
        {% endif %}
    </div>
    {% endfor %}
    {% endif %}

    {% if next_cursor or previous_cursor %}
    <div style="margin-top: 20px; float:left; clear:left">
        <ul class="pager">
            {% if previous_cursor %}
            <li>
                <a id="challenge_submissions_previous" href="#" data-challenge_key="{{ challenge.key.urlsafe() }}">Previous</a>
            </li>
            {% endif %}
            {% if submissions|length > 0 %}
            <li>
                <a id="challenge_submissions_next" href="#" data-cursor="{{ next_cursor }}" data-previous_cursor="{{ previous_cursor }}" data-challenge_key="{{ challenge.key.urlsafe() }}">Next</a>
            </li>
            {% endif %}
        </ul>
    </div>
    {% endif %}
</div>

<div id="submissionFeedbacksContainer" style="width:80%; float:left; clear:both; margin-left: 10px; display:none">
    <ul id="submission_feedbacks_tab" class="nav nav-tabs">
        <li class="active"><a href="#submissionFeedbacks" data-toggle="tab">Other Incoming Jeeqs</a></li>
    </ul>
    <div id="submissionFeedbacks" style="width: 100%; max-height: 200px;overflow-y: auto;">
        {% include "in_jeeqs_list.html" %}
    </div>
</div>